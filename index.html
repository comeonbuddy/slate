
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Instant Access Partner - API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;javascript&quot;,&quot;javascript--react&quot;,&quot;objective_c&quot;,&quot;php&quot;,&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">JavaScript</a>
              <a href="#" data-language-name="javascript--react">React</a>
              <a href="#" data-language-name="objective_c">Objective-C</a>
              <a href="#" data-language-name="php">PHP</a>
              <a href="#" data-language-name="javascript">Google Cloud Functions</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#ia-documentation" class="toc-h1 toc-link" data-title="IA Documentation">IA Documentation</a>
          </li>
          <li>
            <a href="#ia-partner-integration" class="toc-h1 toc-link" data-title="IA Partner Integration">IA Partner Integration</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#for-signing-up-signing-in" class="toc-h2 toc-link" data-title="For signing up / signing in.">For signing up / signing in.</a>
                  </li>
                  <li>
                    <a href="#for-collecting-payment-from-your-clients" class="toc-h2 toc-link" data-title="For collecting payment from your clients.">For collecting payment from your clients.</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#handling-ia-authentication" class="toc-h1 toc-link" data-title="Handling IA Authentication">Handling IA Authentication</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#success" class="toc-h2 toc-link" data-title="Success">Success</a>
                  </li>
                  <li>
                    <a href="#denied-or-failed" class="toc-h2 toc-link" data-title="Denied or Failed">Denied or Failed</a>
                  </li>
                  <li>
                    <a href="#timeout" class="toc-h2 toc-link" data-title="Timeout">Timeout</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#callback-implementation" class="toc-h1 toc-link" data-title="Callback Implementation">Callback Implementation</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#callback-when-user-approve-request-over-ia-app" class="toc-h2 toc-link" data-title="Callback when user approve request over IA App">Callback when user approve request over IA App</a>
                  </li>
                  <li>
                    <a href="#callback-when-user-update-any-information" class="toc-h2 toc-link" data-title="Callback when user update any information">Callback when user update any information</a>
                  </li>
                  <li>
                    <a href="#fetching-user-access-token-from-ia-api" class="toc-h2 toc-link" data-title="Fetching User Access Token from IA API">Fetching User Access Token from IA API</a>
                  </li>
                  <li>
                    <a href="#refreshing-user-access-token-from-ia-api" class="toc-h2 toc-link" data-title="Refreshing User Access Token from IA API">Refreshing User Access Token from IA API</a>
                  </li>
                  <li>
                    <a href="#fetching-user-information-from-ia-api" class="toc-h2 toc-link" data-title="Fetching User Information from IA API">Fetching User Information from IA API</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='http://www.instantaccess.io/partner'>Partner Sign Up</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='ia-documentation'>IA Documentation</h1>
<p><img src="images/headerImg.svg" width="100%"/></p>

<p>Before you start, you will need 2 keys<br/>
- Client ID Key<br/>
- Client Secret Key<br/><br/>
Contact us at <a href="email:yo@instantaccess.io">yo@instantaccess.io</a> if you do not have these. You will need to provide us with a callback url to receive user info from our server.</p>
<h1 id='ia-partner-integration'>IA Partner Integration</h1>
<p>Once you are ready, simply add one of the following <code>code snippets</code> where you want IA button to appear.</p>

<aside class="notice">
Please note: IA button will only work under the domain name you registered with us. If your dev environment is under a different domain, please contact us via our <a href="http://bit.ly/2yhKXXs" target="_blank">dev slack channel</a>
</aside>

<aside class="notice">
You must replace <code>IA_PARTNER_CLIENT_ID_KEY</code> with your IA partner client id key.
</aside>

<aside class="notice">
You must replace <code>IA_PARTNER_CLIENT_SECRET_KEY</code> with your IA partner client secret key.
</aside>

<p>You can integrate the IA button for different two scenarios:
1- For signing up / signing in.
2- For collecting payment from your clients.</p>
<h2 id='for-signing-up-signing-in'>For signing up / signing in.</h2>
<ul>
<li><p>To integrate IA on your website for signin up or signing in, you will need to add the JavaScript or React code snippet to your website.</p></li>
<li><p>To integrate IA in your iOS App for signin up or signing in, you will need to add the Objective-C units to your project.</p></li>
</ul>
<pre class="highlight javascript tab-javascript"><code>  <span class="c">&lt;!--</span> <span class="nx">IA</span> <span class="nx">Authentication</span> <span class="o">--&gt;</span>
  <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"text/javascript"</span><span class="o">&gt;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">client_id</span> <span class="o">=</span> <span class="s1">'IA_PARTNER_CLIENT_ID_KEY'</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">client_secret</span> <span class="o">=</span> <span class="s1">'IA_PARTNER_CLIENT_SECRET_KEY'</span><span class="p">;</span>

      <span class="kd">function</span> <span class="nx">successIA</span><span class="p">(</span><span class="nx">usernameOrEmail</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle successLogin in IA</span>
        <span class="c1">// Example: window.location = 'IACompleteRegisteration.php?iaUser='+usernameOrEmail</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">deniedIA</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">timeoutIA</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>


      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'ia-framework-login'</span><span class="p">).</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">'https://dashboard.instantaccess.io/api/partner/authorize/view?client_id='</span><span class="o">+</span><span class="nx">client_id</span><span class="o">+</span><span class="s1">'&amp;client_secret='</span><span class="o">+</span><span class="nx">client_secret</span><span class="p">;</span>
      <span class="c1">//listen to ia back</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!==</span> <span class="s1">'https://dashboard.instantaccess.io'</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'alert'</span><span class="p">)</span>
          <span class="nx">alert</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'closeframe'</span><span class="p">)</span> <span class="p">{</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"ia-btn"</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">"block"</span><span class="p">;</span>
          <span class="nx">fade</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"ia-framework-login"</span><span class="p">));</span>
          <span class="c1">//document.getElementById("ia-framework-login").style.display = "none";</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'auth'</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">switch</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">'success'</span><span class="p">:</span>
              <span class="nx">successIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">usernameOrEmail</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">'denied'</span><span class="p">:</span>
              <span class="nx">deniedIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">'timeout'</span><span class="p">:</span>
              <span class="nx">timeoutIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">iaButtonClicked</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">unfade</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"ia-framework-login"</span><span class="p">));</span>
      <span class="c1">//document.getElementById("ia-framework-login").style.display = "block";</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"ia-btn"</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">fade</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// initial opacity</span>
      <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">op</span> <span class="o">&lt;=</span> <span class="mf">0.1</span><span class="p">){</span>
          <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
          <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">'none'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">op</span><span class="p">;</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="s1">'alpha(opacity='</span> <span class="o">+</span> <span class="nx">op</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">;</span>
        <span class="nx">op</span> <span class="o">-=</span> <span class="nx">op</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span>
      <span class="p">},</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">unfade</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>  <span class="c1">// initial opacity</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">'block'</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">op</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">){</span>
          <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">op</span><span class="p">;</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="s1">'alpha(opacity='</span> <span class="o">+</span> <span class="nx">op</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">;</span>
        <span class="nx">op</span> <span class="o">+=</span> <span class="nx">op</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span>
      <span class="p">},</span> <span class="mi">5</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="s2">"display: inline-block; position: relative;"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"button"</span> <span class="nx">onclick</span><span class="o">=</span><span class="s2">"iaButtonClicked()"</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"ia-btn"</span> <span class="nx">style</span><span class="o">=</span><span class="s2">"background-color: #4A4A4A; border-width: 0; padding: 0; width: 56px; height: 56px; border-radius:10px;"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"https://dashboard.instantaccess.io/upload/image/whitelogo.svg"</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">iframe</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"ia-framework-login"</span> <span class="nx">src</span><span class="o">=</span><span class="s2">""</span> <span class="nx">width</span><span class="o">=</span><span class="s2">"170"</span> <span class="nx">height</span><span class="o">=</span><span class="s2">"215"</span> <span class="nx">frameBorder</span><span class="o">=</span><span class="s2">"0"</span> <span class="nx">style</span><span class="o">=</span><span class="s2">"display:none; border-radius:10px; z-index: 1000; position: absolute; left: 0px; bottom: 0px;"</span><span class="o">&gt;&lt;</span><span class="sr">/iframe</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
    <span class="err">#</span><span class="nx">ia</span><span class="o">-</span><span class="nx">btn</span><span class="p">:</span><span class="nx">focus</span> <span class="p">{</span>
      <span class="nx">outline</span><span class="o">-</span><span class="nx">width</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="err">#</span><span class="nx">ia</span><span class="o">-</span><span class="nx">btn</span><span class="p">:</span><span class="nx">hover</span> <span class="p">{</span>
      <span class="nl">opacity</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">;</span>
      <span class="nl">cursor</span><span class="p">:</span> <span class="nx">pointer</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span>  <span class="c">&lt;!--</span> <span class="nx">End</span> <span class="nx">of</span> <span class="nx">login</span> <span class="kd">with</span> <span class="nx">IA</span> <span class="o">--&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript--react"><code><span class="o">&gt;</span> <span class="nx">Step</span> <span class="mi">1</span><span class="p">:</span> <span class="nx">IAButton</span> <span class="nx">React</span> <span class="nx">component</span> <span class="nx">source</span> <span class="nx">code</span> <span class="o">-</span> <span class="nx">save</span> <span class="k">this</span> <span class="nx">file</span> <span class="nx">as</span> <span class="nx">IAButton</span><span class="p">.</span><span class="nx">js</span> <span class="k">in</span> <span class="nx">your</span> <span class="nx">project</span>

<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">"react"</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">PropTypes</span> <span class="nx">from</span> <span class="s1">'prop-types'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">IAButton</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

    <span class="nx">constructor</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">iaWhiteLogoSource</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">iaServer</span><span class="o">+</span><span class="s1">'/upload/image/whitelogo.svg'</span><span class="p">,</span>
            <span class="na">iaFrameSource</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">iaServer</span><span class="o">+</span><span class="s1">'/api/partner/authorize/view?client_id='</span><span class="o">+</span><span class="nx">props</span><span class="p">.</span><span class="nx">clientId</span><span class="o">+</span><span class="s1">'&amp;client_secret='</span><span class="o">+</span><span class="nx">props</span><span class="p">.</span><span class="nx">clientSecret</span><span class="o">+</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">payment</span><span class="p">?(</span><span class="s1">'&amp;payment='</span><span class="o">+</span><span class="nx">props</span><span class="p">.</span><span class="nx">payment</span><span class="p">):</span><span class="s1">''</span><span class="p">),</span>
            <span class="na">iaButtonHovered</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">iaButtonFocused</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">iaButtonHidden</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">iaFrameDisplayed</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">iaFrameOpacity</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="na">iaFrameFilter</span><span class="p">:</span> <span class="s1">'alpha(opacity=0)'</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">componentDidMount</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleIAMessage</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">componentWillUnmount</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleIAMessage</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">handleIAMessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">eventOrigin</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">origin</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">iaServer</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">"http"</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">eventOrigin</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">"http:"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">eventOrigin</span> <span class="o">=</span> <span class="nx">eventOrigin</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">eventOrigin</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">"https:"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">eventOrigin</span> <span class="o">=</span> <span class="nx">eventOrigin</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">eventOrigin</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">iaServer</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'alert'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'closeframe'</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="na">iaBtnHidden</span><span class="p">:</span> <span class="kc">false</span>
            <span class="p">});</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">fadeIAFrame</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'auth'</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="s1">'success'</span><span class="p">:</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">successIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">usernameOrEmail</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="s1">'denied'</span><span class="p">:</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">deniedIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="s1">'timeout'</span><span class="p">:</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">timeoutIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">successIA</span> <span class="p">(</span><span class="nx">usernameOrEmail</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle successLogin in IA</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">successIA</span><span class="p">(</span><span class="nx">usernameOrEmail</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">deniedIA</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">notifyUser</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">deniedIA</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">timeoutIA</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">notifyUser</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">timeoutIA</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">iaButtonClicked</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">unfadeIAFrame</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="na">iaBtnHidden</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">fadeIAFrame</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// initial opacity</span>
        <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">op</span> <span class="o">&lt;=</span> <span class="mf">0.1</span><span class="p">){</span>
                <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaFrameDisplayed</span><span class="p">:</span> <span class="kc">false</span><span class="p">});</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="na">iaFrameOpacity</span><span class="p">:</span> <span class="nx">op</span><span class="p">,</span>
                <span class="na">iaFrameFilter</span><span class="p">:</span> <span class="s1">'alpha(opacity='</span> <span class="o">+</span> <span class="nx">op</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s1">')'</span>
            <span class="p">});</span>
            <span class="nx">op</span> <span class="o">-=</span> <span class="nx">op</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span>
        <span class="p">},</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">unfadeIAFrame</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>  <span class="c1">// initial opacity</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaFrameDisplayed</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
        <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">op</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">){</span>
                <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="na">iaFrameOpacity</span><span class="p">:</span> <span class="nx">op</span><span class="p">,</span>
                <span class="na">iaFrameFilter</span><span class="p">:</span> <span class="s1">'alpha(opacity='</span> <span class="o">+</span> <span class="nx">op</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s1">')'</span>
            <span class="p">});</span>
            <span class="nx">op</span> <span class="o">+=</span> <span class="nx">op</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span>
        <span class="p">},</span> <span class="mi">5</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">mainDiv</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"button"</span>
                        <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">iaButtonClicked</span><span class="p">()}</span>
                        <span class="nx">onMouseEnter</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaButtonHovered</span><span class="p">:</span> <span class="kc">true</span><span class="p">})}</span>
                        <span class="nx">onMouseLeave</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaButtonHovered</span><span class="p">:</span> <span class="kc">false</span><span class="p">})}</span>
                        <span class="nx">onFocus</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaButtonFocused</span><span class="p">:</span> <span class="kc">true</span><span class="p">})}</span>
                        <span class="nx">onBlur</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaButtonFocused</span><span class="p">:</span> <span class="kc">false</span><span class="p">})}</span>
                        <span class="nx">style</span><span class="o">=</span><span class="p">{{...</span><span class="nx">styles</span><span class="p">.</span><span class="nx">iaBtn</span><span class="p">,</span> <span class="p">...{</span><span class="na">opacity</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaButtonHovered</span> <span class="p">?</span> <span class="mf">0.9</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">outlineWidth</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaButtonFocused</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="s1">'inherit'</span><span class="p">,</span> <span class="na">display</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaBtnHidden</span> <span class="p">?</span> <span class="s1">'hidden'</span> <span class="p">:</span> <span class="s1">'block'</span><span class="p">}}}</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaWhiteLogoSource</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">iframe</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaFrameSource</span><span class="p">}</span> <span class="nx">width</span><span class="o">=</span><span class="s2">"170"</span> <span class="nx">height</span><span class="o">=</span><span class="s2">"215"</span> <span class="nx">frameBorder</span><span class="o">=</span><span class="s2">"0"</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{...</span><span class="nx">styles</span><span class="p">.</span><span class="nx">iaFrame</span><span class="p">,</span> <span class="p">...{</span><span class="na">opacity</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaFrameOpacity</span><span class="p">,</span> <span class="na">filter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaFrameFilter</span><span class="p">,</span> <span class="na">display</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaFrameDisplayed</span> <span class="p">?</span> <span class="s1">'block'</span> <span class="p">:</span> <span class="s1">'none'</span><span class="p">}}}</span><span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">IAButton</span><span class="p">.</span><span class="nx">propTypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">iaServer</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">string</span><span class="p">,</span>
    <span class="na">clientId</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">string</span><span class="p">.</span><span class="nx">isRequired</span><span class="p">,</span>
    <span class="na">clientSecret</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">string</span><span class="p">.</span><span class="nx">isRequired</span><span class="p">,</span>
    <span class="na">payment</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">string</span><span class="p">,</span>
    <span class="na">notifyUser</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">bool</span><span class="p">,</span>
    <span class="na">successIA</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">.</span><span class="nx">isRequired</span><span class="p">,</span>
    <span class="na">deniedIA</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">.</span><span class="nx">isRequired</span><span class="p">,</span>
    <span class="na">timeoutIA</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">.</span><span class="nx">isRequired</span>
<span class="p">};</span>

<span class="nx">IAButton</span><span class="p">.</span><span class="nx">defaultProps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">notifyUser</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">iaServer</span><span class="p">:</span> <span class="s1">'//dashboard.instantaccess.io'</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">styles</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">mainDiv</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">display</span><span class="p">:</span> <span class="s1">'inline-block'</span><span class="p">,</span>
        <span class="na">position</span><span class="p">:</span> <span class="s1">'relative'</span>
    <span class="p">},</span>
    <span class="na">iaBtn</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">backgroundColor</span><span class="p">:</span> <span class="s1">'#4A4A4A'</span><span class="p">,</span>
        <span class="na">borderWidth</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">width</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span>
        <span class="na">height</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span>
        <span class="na">borderRadius</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
        <span class="na">cursor</span><span class="p">:</span> <span class="s1">'pointer'</span>
    <span class="p">},</span>
    <span class="na">iaFrame</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">display</span><span class="p">:</span><span class="s1">'none'</span><span class="p">,</span>
        <span class="na">borderRadius</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
        <span class="na">zIndex</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="na">position</span><span class="p">:</span> <span class="s1">'absolute'</span><span class="p">,</span>
        <span class="na">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">bottom</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="o">&gt;</span> <span class="nx">End</span> <span class="nx">of</span> <span class="nx">Step</span> <span class="mi">1</span>


<span class="o">&gt;</span> <span class="nx">Step</span> <span class="mi">2</span><span class="p">:</span> <span class="nx">Add</span> <span class="nx">IAButton</span> <span class="nx">component</span> <span class="nx">where</span> <span class="nx">you</span> <span class="nx">need</span>

  <span class="o">&lt;</span><span class="nx">IAButton</span> <span class="nx">clientId</span><span class="o">=</span><span class="s2">"IA_PARTNER_CLIENT_ID_KEY"</span>
            <span class="nx">clientSecret</span><span class="o">=</span><span class="s2">"IA_PARTNER_CLIENT_SECRET_KEY"</span>
            <span class="nx">notifyUser</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span>
            <span class="nx">successIA</span><span class="o">=</span><span class="p">{(</span><span class="nx">usernameOrEmail</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">IA_SUCCESS_HANDLER</span><span class="p">}</span>
            <span class="nx">deniedIA</span><span class="o">=</span><span class="p">{(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">OPTIONAL_IA_DENIED_HANDLER</span><span class="p">}</span>
            <span class="nx">timeoutIA</span><span class="o">=</span><span class="p">{(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">OPTIONAL_IA_TIMEOUT_HANDLER</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>
<span class="o">&gt;</span> <span class="na">Note</span><span class="p">:</span> <span class="nx">In</span> <span class="nx">IA_SUCCESS_HANDLER</span> <span class="nx">you</span> <span class="nx">should</span> <span class="nx">handle</span> <span class="nx">user</span> <span class="nx">authentication</span> <span class="nx">and</span> <span class="nx">make</span> <span class="nx">actions</span><span class="p">,</span> <span class="nx">applicable</span> <span class="nx">to</span> <span class="nx">your</span> <span class="nx">website</span>

<span class="o">&gt;</span> <span class="na">Note</span><span class="p">:</span> <span class="nx">If</span> <span class="nx">you</span> <span class="nx">don</span><span class="err">'</span><span class="nx">t</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">handle</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">denied</span><span class="p">,</span> <span class="nx">or</span> <span class="nx">timeout</span><span class="p">,</span> <span class="nx">replace</span> <span class="o">*</span><span class="nx">_HANDLER</span> <span class="kd">with</span> <span class="p">{}</span>

<span class="o">&gt;</span> <span class="nx">End</span> <span class="nx">of</span> <span class="nx">Step</span> <span class="mi">2</span>
</code></pre><pre class="highlight objective_c tab-objective_c"><code>
<span class="o">*</span> <span class="n">Step</span> <span class="mi">1</span><span class="o">:</span> <span class="n">add</span> <span class="n">the</span> <span class="n">following</span> <span class="n">units</span> <span class="n">to</span> <span class="n">your</span> <span class="n">project</span><span class="o">:</span>

<span class="c1">//
//  IALogin.h
//  https://WhatTuDu.com
//
//  Created by Christophe Delhaze - http://pikorua.it (chris@pikorua.it) on 7/12/17.
//  Copyright © 2017-2018 Christophe Delhaze. All rights reserved.
//
</span>
<span class="cp">#import &lt;Foundation/Foundation.h&gt;
</span>
<span class="k">typedef</span> <span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="n">CompletionBlock</span><span class="p">)(</span><span class="n">BOOL</span> <span class="n">success</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">,</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="n">userData</span><span class="p">);</span>

<span class="c1">//Parameters required by IA
</span><span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">client_id</span> <span class="o">=</span> <span class="s">@"client_id"</span><span class="p">;</span> <span class="c1">// Insert your client_id here
</span><span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">client_secret</span> <span class="o">=</span> <span class="s">@"client_secret"</span><span class="p">;</span> <span class="c1">// Insert your client_secret here
</span><span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">partnerDomainURL</span> <span class="o">=</span> <span class="s">@"partnerDomainURL"</span><span class="p">;</span> <span class="c1">// Enter the domain you registered with IA
</span><span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">iaAuthorizeURL</span> <span class="o">=</span> <span class="s">@"https://dashboard.instantaccess.io/api/partner/authorize"</span><span class="p">;</span> <span class="c1">// To request authorization
</span><span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">iaAuthorizeStatusURL</span> <span class="o">=</span> <span class="s">@"https://dashboard.instantaccess.io/api/partner/status"</span><span class="p">;</span> <span class="c1">// To check the request status
</span><span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">payment</span> <span class="o">=</span> <span class="s">@""</span><span class="p">;</span> <span class="c1">// Not implemented in this version - Sign up / Login only.
</span><span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">statusCallInterval</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// in seconds
</span><span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">statusCheckingMaximumTime</span> <span class="o">=</span> <span class="mi">600</span><span class="p">;</span> <span class="c1">// in seconds
</span>
<span class="c1">//Additional Parameters to fetch the user data from your server (IA can only do call back to your server so your app will need to fetch the data from there.)
//For this example we used php script on the server to fetch the data from a mySQL database.
//You will need to secure your call to your server to prevent unauthorized access to your user data.
//In this demo code, we will use basic security and do direct calls through https using a key/password conbination.
</span><span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">domainKey</span> <span class="o">=</span> <span class="s">@"your_server_secret_key"</span><span class="p">;</span>
<span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">domainPassword</span> <span class="o">=</span> <span class="s">@"your_server_secret_password"</span><span class="p">;</span>
<span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">userDataURLFormat</span> <span class="o">=</span> <span class="s">@"https://yourwebsite.com/get/userData/%@/%@/%@"</span><span class="p">;</span>
<span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">userIDDataURLFormat</span> <span class="o">=</span> <span class="s">@"https://yourwebsite.com/get/userIDData/%@/%@/%@"</span><span class="p">;</span>
<span class="k">const</span> <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">userTokenDataURLFormat</span> <span class="o">=</span> <span class="s">@"https://yourwebsite.com/get/userTokenData/%@/%@/%@"</span><span class="p">;</span>

<span class="k">@interface</span> <span class="nc">IALogin</span> <span class="p">:</span> <span class="nc">NSObject</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">userName</span><span class="p">;</span> <span class="c1">//Entered by the user on your app login screen
</span><span class="k">@property</span> <span class="p">(</span><span class="n">assign</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="kt">int</span> <span class="n">statusCounter</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSTimer</span> <span class="o">*</span><span class="n">connectionTimer</span><span class="p">;</span> <span class="c1">//Timer used to schedule a status check call then a user data call
</span><span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">CompletionBlock</span> <span class="n">completionBlock</span><span class="p">;</span> <span class="c1">//Block called on success or failure of the IA login
</span>
<span class="k">+</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">IALoginWithUsername</span><span class="p">:(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span> <span class="n">userName</span><span class="p">;</span> <span class="c1">//Create an instance of the IALogin Class
</span>
<span class="c1">//Perform login. We pass the completion block, a caller (view) that will be displaying a HUD while the login is in process and will also allow to cancel the login process.
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">login</span><span class="p">:(</span><span class="n">CompletionBlock</span><span class="p">)</span><span class="nv">completionBlock</span> <span class="nf">caller</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">caller</span> <span class="nf">displayHUD</span><span class="p">:(</span><span class="n">SEL</span><span class="p">)</span><span class="nv">displayHUD</span><span class="p">;</span>

<span class="c1">//Cancel login process
</span><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">cancel</span><span class="p">;</span>

<span class="k">@end</span>


<span class="c1">//
//  IALogin.m
//  https://WhatTuDu.com
//
//  Created by Christophe Delhaze - http://pikorua.it (chris@pikorua.it) on 7/12/17.
//  Copyright © 2017-2018 Christophe Delhaze. All rights reserved.
//
</span>
<span class="cp">#import "IALogin.h"
</span>
<span class="cp">#import &lt;UserNotifications/UserNotifications.h&gt;
</span>
<span class="k">@implementation</span> <span class="nc">IALogin</span>

<span class="cm">/* Create and instance of IALogin Class and set the userName */</span>
<span class="k">+</span><span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">IALoginWithUsername</span><span class="p">:(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span> <span class="n">userName</span><span class="p">{</span>
    <span class="n">IALogin</span> <span class="o">*</span><span class="n">iaLogin</span> <span class="o">=</span> <span class="p">[</span><span class="n">IALogin</span> <span class="nf">new</span><span class="p">];</span>
    <span class="n">iaLogin</span><span class="p">.</span><span class="n">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">iaLogin</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Cancel the login process*/</span>
<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">cancel</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">connectionTimer</span> <span class="nf">invalidate</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">connectionTimer</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">completionBlock</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSError</span> <span class="nf">errorWithDomain</span><span class="p">:</span><span class="s">@"com.IA.error"</span> <span class="nf">code</span><span class="p">:</span><span class="mi">2</span> <span class="n">userInfo</span><span class="o">:</span><span class="p">@{</span><span class="s">@"message"</span><span class="o">:</span><span class="s">@"User Cancelled IA Login."</span><span class="p">}];</span>
        <span class="n">self</span><span class="p">.</span><span class="n">completionBlock</span><span class="p">(</span><span class="nb">NO</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Start the login process*/</span>
<span class="cm">/* In a perfect world, Your app would be able to open IA App once the login start and once the user is done with the login process, IA App would open back your app to complete the login */</span>
<span class="cm">/* At the present stage, IA App doesn't have an URL Scheme and doesn't allow to call your app URL Scheme. */</span>
<span class="cm">/* As a work around, IA server will send a push notification to proceed with the login. Your app will be using Local Notifications to bring back the user into your app once the login is complete*/</span>
<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">login</span><span class="o">:</span><span class="p">(</span><span class="n">CompletionBlock</span><span class="p">)</span><span class="n">completionBlock</span> <span class="n">caller</span><span class="o">:</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">caller</span> <span class="n">displayHUD</span><span class="o">:</span><span class="p">(</span><span class="n">SEL</span><span class="p">)</span><span class="n">displayHUD</span><span class="p">{</span>
    <span class="n">UNUserNotificationCenter</span><span class="o">*</span> <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">UNUserNotificationCenter</span> <span class="nf">currentNotificationCenter</span><span class="p">];</span>
    <span class="p">[</span><span class="n">center</span> <span class="nf">getNotificationSettingsWithCompletionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">UNNotificationSettings</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">settings</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">authorizationStatus</span> <span class="o">==</span> <span class="n">UNAuthorizationStatusNotDetermined</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">UIAlertController</span> <span class="o">*</span><span class="n">alert</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIAlertController</span> <span class="nf">alertControllerWithTitle</span><span class="p">:</span><span class="s">@"IA Works better with Local Notifications"</span> <span class="nf">message</span><span class="p">:</span><span class="s">@"Please allow Local Notifications to Log In with IA."</span> <span class="n">preferredStyle</span><span class="o">:</span><span class="n">UIAlertControllerStyleAlert</span><span class="p">];</span>
            <span class="p">[</span><span class="n">alert</span> <span class="nf">addAction</span><span class="p">:[</span><span class="n">UIAlertAction</span> <span class="nf">actionWithTitle</span><span class="p">:</span><span class="s">@"Nope :("</span> <span class="nf">style</span><span class="p">:</span><span class="n">UIAlertActionStyleDestructive</span> <span class="nf">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">UIAlertAction</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">action</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">self</span> <span class="nf">proceedWithLogin</span><span class="p">:</span><span class="n">completionBlock</span><span class="p">];</span>
            <span class="p">}]];</span>
            <span class="p">[</span><span class="n">alert</span> <span class="nf">addAction</span><span class="p">:[</span><span class="n">UIAlertAction</span> <span class="nf">actionWithTitle</span><span class="p">:</span><span class="s">@"Sounds Great :D"</span> <span class="nf">style</span><span class="p">:</span><span class="n">UIAlertActionStyleDefault</span> <span class="nf">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">UIAlertAction</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">action</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">center</span> <span class="nf">requestAuthorizationWithOptions</span><span class="p">:(</span><span class="n">UNAuthorizationOptionAlert</span> <span class="o">+</span> <span class="n">UNAuthorizationOptionSound</span> <span class="o">+</span> <span class="n">UNAuthorizationOptionBadge</span><span class="p">)</span>
                                      <span class="nf">completionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">granted</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                                          <span class="p">[</span><span class="n">caller</span> <span class="nf">performSelectorOnMainThread</span><span class="p">:</span><span class="n">displayHUD</span> <span class="nf">withObject</span><span class="p">:</span><span class="nb">nil</span> <span class="n">waitUntilDone</span><span class="o">:</span><span class="nb">YES</span><span class="p">];</span>
                                          <span class="p">[</span><span class="n">self</span> <span class="nf">proceedWithLogin</span><span class="p">:</span><span class="n">completionBlock</span><span class="p">];</span>
                                      <span class="p">}];</span>
            <span class="p">}]];</span>
            <span class="p">[[[[</span><span class="n">UIApplication</span> <span class="nf">sharedApplication</span><span class="p">]</span> <span class="nf">keyWindow</span><span class="p">]</span> <span class="nf">rootViewController</span><span class="p">]</span> <span class="nf">presentViewController</span><span class="p">:</span><span class="n">alert</span> <span class="nf">animated</span><span class="p">:</span><span class="nb">YES</span> <span class="n">completion</span><span class="o">:^</span><span class="p">{</span>

            <span class="p">}];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">caller</span> <span class="nf">performSelectorOnMainThread</span><span class="p">:</span><span class="n">displayHUD</span> <span class="nf">withObject</span><span class="p">:</span><span class="nb">nil</span> <span class="n">waitUntilDone</span><span class="o">:</span><span class="nb">YES</span><span class="p">];</span>
            <span class="p">[</span><span class="n">self</span> <span class="nf">proceedWithLogin</span><span class="p">:</span><span class="n">completionBlock</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="cm">/* Proceed with the actual login. We will call IA server to request authorization*/</span>
<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">proceedWithLogin</span><span class="o">:</span><span class="p">(</span><span class="n">CompletionBlock</span><span class="p">)</span><span class="n">completionBlock</span><span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">completionBlock</span> <span class="o">=</span> <span class="n">completionBlock</span><span class="p">;</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">urlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="s">@"%@?client_id=%@&amp;client_secret=%@&amp;user_identifier=%@"</span><span class="p">,</span> <span class="n">iaAuthorizeURL</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">userName</span><span class="p">];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">JSONString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithContentsOfURL</span><span class="p">:[</span><span class="n">NSURL</span> <span class="nf">URLWithString</span><span class="p">:</span><span class="n">urlString</span><span class="p">]</span> <span class="nf">encoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">completionBlock</span><span class="p">(</span><span class="nb">NO</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">loginAuthenticationResponse</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">JSONString</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSData</span><span class="o">*</span> <span class="n">jsonEventsData</span> <span class="o">=</span> <span class="p">[</span><span class="n">JSONString</span> <span class="nf">dataUsingEncoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">jsonEventsData</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
            <span class="n">loginAuthenticationResponse</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSJSONSerialization</span>
                                           <span class="nf">JSONObjectWithData</span><span class="p">:</span><span class="n">jsonEventsData</span>
                                           <span class="nf">options</span><span class="p">:</span><span class="mi">0</span>
                                           <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">self</span><span class="p">.</span><span class="n">completionBlock</span><span class="p">(</span><span class="nb">NO</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
              <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">loginAuthenticationResponse</span><span class="p">[</span><span class="s">@"success"</span><span class="p">]</span><span class="nf">boolValue</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
            <span class="n">self</span><span class="p">.</span><span class="n">connectionTimer</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSTimer</span> <span class="nf">scheduledTimerWithTimeInterval</span><span class="p">:</span><span class="n">statusCallInterval</span> <span class="nf">repeats</span><span class="p">:</span><span class="nb">NO</span> <span class="n">block</span><span class="o">:^</span><span class="p">(</span><span class="n">NSTimer</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">timer</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">self</span> <span class="nf">checkStatus</span><span class="p">];</span>
            <span class="p">}];</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">checkStatus</span> <span class="p">{</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">urlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="s">@"%@?client_id=%@&amp;client_secret=%@&amp;user_identifier=%@"</span><span class="p">,</span> <span class="n">iaAuthorizeStatusURL</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">userName</span><span class="p">];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">JSONString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithContentsOfURL</span><span class="p">:[</span><span class="n">NSURL</span> <span class="nf">URLWithString</span><span class="p">:</span><span class="n">urlString</span><span class="p">]</span> <span class="nf">encoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">loginAuthenticationResponse</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">JSONString</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSData</span><span class="o">*</span> <span class="n">jsonEventsData</span> <span class="o">=</span> <span class="p">[</span><span class="n">JSONString</span> <span class="nf">dataUsingEncoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">jsonEventsData</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
            <span class="n">loginAuthenticationResponse</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSJSONSerialization</span>
                                           <span class="nf">JSONObjectWithData</span><span class="p">:</span><span class="n">jsonEventsData</span>
                                           <span class="nf">options</span><span class="p">:</span><span class="mi">0</span>
                                           <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">([</span><span class="n">loginAuthenticationResponse</span><span class="p">[</span><span class="s">@"success"</span><span class="p">]</span> <span class="nf">boolValue</span><span class="p">]</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">loginAuthenticationResponse</span><span class="p">[</span><span class="s">@"message"</span><span class="p">]</span> <span class="nf">isEqualToString</span><span class="p">:</span> <span class="s">@"User has previously authorized this partner"</span> <span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">authSuccess</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">updateStatus</span><span class="p">:</span><span class="n">loginAuthenticationResponse</span><span class="p">[</span><span class="s">@"data"</span><span class="p">]];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateStatus</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">current</span> <span class="p">{</span>
    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">status</span> <span class="o">=</span> <span class="p">@{</span><span class="s">@"approve"</span><span class="o">:</span><span class="mi">@1</span><span class="p">,</span><span class="s">@"deny"</span><span class="o">:</span><span class="mi">@2</span><span class="p">};</span>
    <span class="k">switch</span> <span class="p">([</span><span class="n">status</span><span class="p">[</span><span class="nf">current</span><span class="p">]</span> <span class="nf">intValue</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
             <span class="p">[</span><span class="n">self</span> <span class="nf">authSuccess</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
            <span class="p">[</span><span class="n">self</span> <span class="nf">authDenied</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">statusCounter</span> <span class="o">*</span> <span class="n">statusCallInterval</span> <span class="o">&gt;</span> <span class="n">statusCheckingMaximumTime</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">self</span> <span class="nf">authTimeout</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">self</span><span class="p">.</span><span class="n">statusCounter</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
                <span class="n">self</span><span class="p">.</span><span class="n">connectionTimer</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSTimer</span> <span class="nf">scheduledTimerWithTimeInterval</span><span class="p">:</span><span class="n">statusCallInterval</span> <span class="nf">repeats</span><span class="p">:</span><span class="nb">NO</span> <span class="n">block</span><span class="o">:^</span><span class="p">(</span><span class="n">NSTimer</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">timer</span><span class="p">)</span> <span class="p">{</span>
                    <span class="p">[</span><span class="n">self</span> <span class="nf">checkStatus</span><span class="p">];</span>
                <span class="p">}];</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">authSuccess</span><span class="p">{</span>
    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">connectionTimer</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSTimer</span> <span class="nf">scheduledTimerWithTimeInterval</span><span class="p">:</span><span class="n">statusCallInterval</span> <span class="nf">repeats</span><span class="p">:</span><span class="nb">NO</span> <span class="n">block</span><span class="o">:^</span><span class="p">(</span><span class="n">NSTimer</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">timer</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">self</span> <span class="nf">getUserData</span><span class="p">];</span>
        <span class="p">}];</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">authDenied</span><span class="p">{</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSError</span> <span class="nf">errorWithDomain</span><span class="p">:</span><span class="s">@"com.IA.error"</span> <span class="nf">code</span><span class="p">:</span><span class="mi">1</span> <span class="n">userInfo</span><span class="o">:</span><span class="p">@{</span><span class="s">@"message"</span><span class="o">:</span><span class="s">@"Authentication Denied"</span><span class="p">}];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">completionBlock</span><span class="p">(</span><span class="nb">NO</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">authTimeout</span><span class="p">{</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSError</span> <span class="nf">errorWithDomain</span><span class="p">:</span><span class="s">@"com.IA.error"</span> <span class="nf">code</span><span class="p">:</span><span class="mi">0</span> <span class="n">userInfo</span><span class="o">:</span><span class="p">@{</span><span class="s">@"message"</span><span class="o">:</span><span class="s">@"Authentication Timed Out"</span><span class="p">}];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">completionBlock</span><span class="p">(</span><span class="nb">NO</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">getUserData</span> <span class="p">{</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">urlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="n">userDataURLFormat</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">userName</span><span class="p">,</span> <span class="n">domainKey</span><span class="p">,</span> <span class="n">domainPassword</span><span class="p">];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">JSONString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithContentsOfURL</span><span class="p">:[</span><span class="n">NSURL</span> <span class="nf">URLWithString</span><span class="p">:</span><span class="n">urlString</span><span class="p">]</span> <span class="nf">encoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">userDataResponse</span><span class="p">;</span>
    <span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">JSONString</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSData</span><span class="o">*</span> <span class="n">jsonEventsData</span> <span class="o">=</span> <span class="p">[</span><span class="n">JSONString</span> <span class="nf">dataUsingEncoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">jsonEventsData</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">userDataResponse</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSJSONSerialization</span>
                                           <span class="nf">JSONObjectWithData</span><span class="p">:</span><span class="n">jsonEventsData</span>
                                           <span class="nf">options</span><span class="p">:</span><span class="mi">0</span>
                                           <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">error</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">JSONString</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">completionBlock</span><span class="p">(</span><span class="nb">YES</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">userDataResponse</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSError</span> <span class="nf">errorWithDomain</span><span class="p">:</span><span class="s">@"com.IA.error"</span> <span class="nf">code</span><span class="p">:</span><span class="mi">2</span> <span class="n">userInfo</span><span class="o">:</span><span class="p">@{</span><span class="s">@"message"</span><span class="o">:</span><span class="s">@"Invalid User Data Returned"</span><span class="p">}];</span>
        <span class="n">self</span><span class="p">.</span><span class="n">completionBlock</span><span class="p">(</span><span class="nb">NO</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">@end</span>


<span class="o">*</span> <span class="n">Step</span> <span class="mi">2</span><span class="o">:</span> <span class="n">Add</span> <span class="n">The</span> <span class="n">UI</span> <span class="n">elements</span> <span class="n">On</span> <span class="n">you</span> <span class="n">login</span> <span class="n">page</span><span class="o">:</span>

<span class="n">You</span> <span class="n">will</span> <span class="n">need</span> <span class="mi">2</span> <span class="n">UIButton</span><span class="err">'</span><span class="n">s</span> <span class="n">and</span> <span class="mi">1</span> <span class="n">UITextField</span><span class="p">.</span>

<span class="mi">1</span> <span class="n">Button</span> <span class="p">(</span><span class="n">IALoginButton</span><span class="p">)</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">make</span> <span class="n">the</span> <span class="n">other</span> <span class="n">button</span> <span class="n">and</span> <span class="n">text</span> <span class="n">field</span> <span class="n">visible</span><span class="p">.</span>
<span class="n">By</span> <span class="k">default</span> <span class="n">that</span> <span class="n">button</span> <span class="n">will</span> <span class="n">use</span> <span class="n">the</span> <span class="n">IA</span> <span class="n">Logo</span><span class="p">.</span> <span class="n">Alternatively</span> <span class="n">as</span> <span class="n">I</span> <span class="n">did</span> <span class="k">in</span> <span class="n">WhatTuDu</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">create</span> <span class="n">a</span> <span class="n">custom</span> <span class="n">button</span> <span class="n">that</span> <span class="n">integrate</span> <span class="n">nicely</span> <span class="k">in</span> <span class="n">your</span> <span class="n">UI</span><span class="p">.</span>
<span class="n">See</span> <span class="n">Resources</span> <span class="n">on</span> <span class="n">the</span> <span class="n">left</span><span class="p">.</span>

<span class="n">The</span> <span class="n">text</span> <span class="n">field</span> <span class="p">(</span><span class="n">IALabel</span><span class="p">)</span> <span class="n">is</span> <span class="n">used</span> <span class="n">by</span> <span class="n">the</span> <span class="n">user</span> <span class="n">to</span> <span class="n">input</span> <span class="n">his</span> <span class="n">user</span> <span class="n">name</span> <span class="n">and</span> <span class="n">the</span> <span class="mi">2</span><span class="n">nd</span> <span class="n">button</span> <span class="p">(</span><span class="n">IAButton</span><span class="p">)</span> <span class="n">is</span> <span class="n">used</span> <span class="n">to</span> <span class="n">proceed</span> <span class="n">with</span> <span class="n">the</span> <span class="n">login</span><span class="p">.</span>

</code></pre>
<p><span style="padding: 10px; width: 100%; background: grey; display: block;margin-left: -28px;padding-left: 28px;padding-right: 28px;">
<strong>iOS Resources:</strong><br/><br/>
* IA Button:<br/><img style="padding: 10px;" src="/images/IAButton.png"/><br/>
* IA Logo for custom buttons:<br/><img style="padding: 10px;" src="/images/whitehand.png"/><br/>
* Custom Button Example:<br/><img style="padding: 10px;" width="350" src="/images/WhatTuDu.png"/><br/>
</span></p>
<pre class="highlight objective_c tab-objective_c"><code>
<span class="o">*</span> <span class="n">Step</span> <span class="mi">3</span><span class="o">:</span> <span class="n">In</span> <span class="n">the</span> <span class="n">LoginViewController</span><span class="p">.</span><span class="n">h</span> <span class="n">add</span> <span class="o">/</span> <span class="n">change</span> <span class="n">the</span> <span class="n">following</span>

<span class="k">@class</span> <span class="nc">IALogin</span><span class="p">;</span>

<span class="k">@interface</span> <span class="nc">LoginViewController</span> <span class="p">:</span> <span class="nc">UIViewController</span> <span class="o">&lt;</span><span class="n">UITextFieldDelegate</span><span class="p">,</span><span class="n">UIViewControllerTransitioningDelegate</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="n">loginWithIA</span><span class="o">:</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">sender</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">displayIAForm</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">IALoginButton</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">IAButton</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITextField</span> <span class="o">*</span><span class="n">IALabel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IALogin</span> <span class="o">*</span><span class="n">iaLogin</span><span class="p">;</span>


<span class="o">*</span> <span class="n">Step</span> <span class="mi">4</span><span class="o">:</span> <span class="n">In</span> <span class="n">LoginViewController</span><span class="p">.</span><span class="n">m</span> <span class="n">add</span> <span class="n">the</span> <span class="n">following</span>

<span class="cp">#import "IALogin.h"
#import &lt;UserNotifications/UserNotifications.h&gt;
</span>
<span class="n">then</span> <span class="k">in</span> <span class="n">the</span> <span class="k">@implementation</span> <span class="nc">part</span><span class="o">:</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">IALabel</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="c1">//keep whatever other code you had in there...
</span><span class="p">}</span>


<span class="c1">//Implement the cancelButtonTapped to your need.
//We hide the HUD and cancel the login then nil the iaLogin object.
</span><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">cancelButtonTapped</span><span class="o">:</span><span class="p">(</span><span class="n">UIButton</span><span class="o">*</span><span class="p">)</span><span class="n">sender</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">hudButton</span> <span class="nf">removeFromSuperview</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">hudButton</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">iaLogin</span> <span class="nf">cancel</span><span class="p">];</span> <span class="c1">//Required
</span>    <span class="n">self</span><span class="p">.</span><span class="n">iaLogin</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span> <span class="c1">// Required
</span>    <span class="p">[</span><span class="n">ProgressHUD</span> <span class="nf">dismiss</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">hideIAForm</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span> <span class="c1">// Required
</span><span class="p">}</span>


<span class="c1">//Implement the displayHUD to your need.
//You have an example of implementation using a modified version of ProgressHUD here...
</span><span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">displayHUD</span><span class="p">{</span>
    <span class="p">[</span><span class="n">ProgressHUD</span> <span class="nf">show</span><span class="p">:</span><span class="s">@"Please login using IA App or Tap here to cancel."</span> <span class="nf">Interaction</span><span class="p">:</span><span class="nb">NO</span><span class="p">];</span>
    <span class="p">[[</span><span class="n">NSRunLoop</span> <span class="nf">currentRunLoop</span><span class="p">]</span> <span class="nf">runUntilDate</span><span class="p">:[</span><span class="n">NSDate</span> <span class="nf">dateWithTimeIntervalSinceNow</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">]];</span>
    <span class="p">[[</span><span class="n">NSRunLoop</span> <span class="nf">mainRunLoop</span><span class="p">]</span> <span class="nf">runUntilDate</span><span class="p">:[</span><span class="n">NSDate</span> <span class="nf">dateWithTimeIntervalSinceNow</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">]];</span>
    <span class="n">ProgressHUD</span> <span class="o">*</span><span class="n">hud</span> <span class="o">=</span> <span class="p">[</span><span class="n">ProgressHUD</span> <span class="nf">shared</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">hudButton</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIButton</span> <span class="nf">buttonWithType</span><span class="p">:</span><span class="n">UIButtonTypeCustom</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">hudButton</span> <span class="nf">addTarget</span><span class="p">:</span><span class="n">self</span> <span class="nf">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">cancelButtonTapped</span><span class="o">:</span><span class="p">)</span> <span class="n">forControlEvents</span><span class="o">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">hudButton</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">hud</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">hudButton</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">zPosition</span> <span class="o">=</span> <span class="n">CGFLOAT_MAX</span><span class="p">;</span>
    <span class="p">[</span><span class="n">hud</span><span class="p">.</span><span class="n">backgroundView</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">hudButton</span><span class="p">];</span>
    <span class="n">hud</span><span class="p">.</span><span class="n">backgroundView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">zPosition</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="n">loginWithIA</span><span class="o">:</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">sender</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">IALabel</span><span class="p">.</span><span class="n">text</span> <span class="nf">isEqualToString</span><span class="p">:</span><span class="s">@""</span><span class="p">])</span> <span class="p">{</span> <span class="c1">//we need a userName
</span>        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">IALabel</span> <span class="nf">resignFirstResponder</span><span class="p">];</span>

        <span class="n">self</span><span class="p">.</span><span class="n">iaLogin</span> <span class="o">=</span> <span class="p">[</span><span class="n">IALogin</span> <span class="nf">IALoginWithUsername</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">IALabel</span><span class="p">.</span><span class="n">text</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">iaLogin</span> <span class="nf">login</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">success</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">,</span> <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">userData</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">UNNotificationCategory</span><span class="o">*</span> <span class="n">loginCategory</span> <span class="o">=</span> <span class="p">[</span><span class="n">UNNotificationCategory</span>
                                                     <span class="nf">categoryWithIdentifier</span><span class="p">:</span><span class="s">@"LOGIN"</span>
                                                     <span class="nf">actions</span><span class="p">:@[]</span>
                                                     <span class="nl">intentIdentifiers:</span><span class="p">@[]</span>
                                                     <span class="nl">options:</span><span class="n">UNNotificationCategoryOptionCustomDismissAction</span><span class="p">];</span>

            <span class="c1">// Register the notification categories.
</span>            <span class="n">UNUserNotificationCenter</span><span class="o">*</span> <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">UNUserNotificationCenter</span> <span class="nf">currentNotificationCenter</span><span class="p">];</span>
            <span class="p">[</span><span class="n">center</span> <span class="nf">setNotificationCategories</span><span class="p">:[</span><span class="n">NSSet</span> <span class="nf">setWithObjects</span><span class="p">:</span><span class="n">loginCategory</span><span class="p">,</span> <span class="nb">nil</span><span class="p">]];</span>

            <span class="n">UNMutableNotificationContent</span><span class="o">*</span> <span class="n">content</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UNMutableNotificationContent</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
            <span class="n">content</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">localizedUserNotificationStringForKey</span><span class="p">:</span><span class="s">@"IA Login!"</span> <span class="nf">arguments</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
            <span class="n">content</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">localizedUserNotificationStringForKey</span><span class="p">:</span><span class="s">@"IA Login Completed!</span><span class="se">\n</span><span class="s">Please go back to WhatTuDu Now!"</span>
                                                                 <span class="nf">arguments</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
            <span class="n">content</span><span class="p">.</span><span class="n">categoryIdentifier</span> <span class="o">=</span> <span class="s">@"LOGIN"</span><span class="p">;</span>
            <span class="n">content</span><span class="p">.</span><span class="n">sound</span> <span class="o">=</span> <span class="p">[</span><span class="n">UNNotificationSound</span> <span class="nf">defaultSound</span><span class="p">];</span>

            <span class="c1">// Configure the trigger
</span>            <span class="n">NSDate</span> <span class="o">*</span><span class="n">now</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDate</span> <span class="nf">dateWithTimeIntervalSinceNow</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">NSCalendar</span> <span class="o">*</span><span class="n">calendar</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSCalendar</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithCalendarIdentifier</span><span class="p">:</span> <span class="n">NSCalendarIdentifierGregorian</span><span class="p">];</span>
            <span class="n">NSDateComponents</span> <span class="o">*</span><span class="n">date</span> <span class="o">=</span> <span class="p">[</span><span class="n">calendar</span> <span class="nf">components</span><span class="p">:</span><span class="n">NSCalendarUnitYear</span><span class="o">|</span><span class="n">NSCalendarUnitMonth</span><span class="o">|</span><span class="n">NSCalendarUnitDay</span><span class="o">|</span><span class="n">NSCalendarUnitHour</span><span class="o">|</span><span class="n">NSCalendarUnitMinute</span><span class="o">|</span><span class="n">NSCalendarUnitSecond</span> <span class="nf">fromDate</span><span class="p">:</span><span class="n">now</span><span class="p">];</span>
            <span class="n">UNCalendarNotificationTrigger</span><span class="o">*</span> <span class="n">trigger</span> <span class="o">=</span> <span class="p">[</span><span class="n">UNCalendarNotificationTrigger</span> <span class="nf">triggerWithDateMatchingComponents</span><span class="p">:</span><span class="n">date</span> <span class="nf">repeats</span><span class="p">:</span><span class="nb">NO</span><span class="p">];</span>

            <span class="c1">// Create the request object.
</span>            <span class="n">UNNotificationRequest</span><span class="o">*</span> <span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="n">UNNotificationRequest</span>
                                              <span class="nf">requestWithIdentifier</span><span class="p">:</span><span class="s">@"IALogin"</span> <span class="nf">content</span><span class="p">:</span><span class="n">content</span> <span class="n">trigger</span><span class="o">:</span><span class="n">trigger</span><span class="p">];</span>

            <span class="p">[</span><span class="n">center</span> <span class="nf">addNotificationRequest</span><span class="p">:</span><span class="n">request</span> <span class="nf">withCompletionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}];</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">//Everything went as planned and we have the userData back from our server.
</span>                <span class="p">[</span><span class="n">self</span> <span class="nf">loginSucceeded</span><span class="p">:</span><span class="n">userData</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">256</span><span class="p">)</span> <span class="p">{</span>
                    <span class="p">[[[</span><span class="n">UIAlertView</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithTitle</span><span class="p">:</span><span class="s">@"Error!"</span> <span class="nf">message</span><span class="p">:</span><span class="s">@"Please enter a valid username and try again."</span> <span class="nf">delegate</span><span class="p">:</span><span class="nb">nil</span> <span class="nf">cancelButtonTitle</span><span class="p">:</span><span class="s">@"OK"</span> <span class="n">otherButtonTitles</span><span class="o">:</span> <span class="nb">nil</span><span class="p">]</span> <span class="n">show</span><span class="p">];</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="p">[[[</span><span class="n">UIAlertView</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithTitle</span><span class="p">:</span><span class="s">@"Error!"</span> <span class="nf">message</span><span class="p">:</span><span class="n">error</span><span class="p">.</span><span class="n">userInfo</span><span class="p">[</span><span class="s">@"message"</span><span class="p">]</span> <span class="nf">delegate</span><span class="p">:</span><span class="nb">nil</span> <span class="nf">cancelButtonTitle</span><span class="p">:</span><span class="s">@"OK"</span> <span class="n">otherButtonTitles</span><span class="o">:</span> <span class="nb">nil</span><span class="p">]</span> <span class="n">show</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">hudButton</span> <span class="nf">removeFromSuperview</span><span class="p">];</span>
            <span class="n">self</span><span class="p">.</span><span class="n">hudButton</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
            <span class="p">[</span><span class="n">ProgressHUD</span> <span class="nf">dismiss</span><span class="p">];</span>
            <span class="n">self</span><span class="p">.</span><span class="n">iaLogin</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
            <span class="p">[</span><span class="n">self</span> <span class="nf">hideIAForm</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
        <span class="p">}</span> <span class="nf">caller</span><span class="p">:</span><span class="n">self</span> <span class="n">displayHUD</span><span class="o">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">displayHUD</span><span class="p">)];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="p">[[[</span><span class="n">UIAlertView</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithTitle</span><span class="p">:</span><span class="s">@"Warning..."</span> <span class="nf">message</span><span class="p">:</span><span class="s">@"Please enter a username and try again."</span> <span class="nf">delegate</span><span class="p">:</span><span class="nb">nil</span> <span class="nf">cancelButtonTitle</span><span class="p">:</span><span class="s">@"OK"</span> <span class="n">otherButtonTitles</span><span class="o">:</span> <span class="nb">nil</span><span class="p">]</span> <span class="n">show</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">loginSucceeded</span><span class="o">:</span><span class="p">(</span><span class="n">NSDictionary</span><span class="o">*</span><span class="p">)</span><span class="n">userData</span><span class="p">{</span>

    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">urlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="n">userIDDataURLFormat</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">IALabel</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="n">domainKey</span><span class="p">,</span> <span class="n">DomainPassword</span><span class="p">];</span>
    <span class="n">NSURL</span> <span class="o">*</span><span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nf">URLWithString</span><span class="p">:</span><span class="n">urlString</span><span class="p">];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">ia_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithContentsOfURL</span><span class="p">:</span><span class="n">url</span> <span class="nf">encoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span> <span class="c1">//Retrieve the user ID
</span>
    <span class="n">urlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="n">userTokenDataURLFormat</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">IALabel</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="n">domainKey</span><span class="p">,</span> <span class="n">DomainPassword</span><span class="p">];</span>
    <span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nf">URLWithString</span><span class="p">:</span><span class="n">urlString</span><span class="p">];</span>
    <span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">access_token</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithContentsOfURL</span><span class="p">:</span><span class="n">url</span> <span class="nf">encoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span> <span class="c1">//Retrieve the access_token
</span>
    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">authData</span> <span class="o">=</span> <span class="p">@{</span>
                               <span class="s">@"access_token"</span>        <span class="o">:</span>   <span class="n">access_token</span><span class="p">,</span>
                               <span class="s">@"id"</span>                  <span class="o">:</span>   <span class="n">ia_id</span><span class="p">,</span>
                               <span class="s">@"username"</span>            <span class="o">:</span>   <span class="n">self</span><span class="p">.</span><span class="n">IALabel</span><span class="p">.</span><span class="n">text</span>
                               <span class="p">};</span>

    <span class="c1">//Create or login to your app server
</span>    <span class="c1">//You will need to implement this based on your server architecture and replace YourServerUserClass accordingly.
</span>    <span class="p">[</span><span class="n">YourServerUserClass</span> <span class="nf">logInInBackgroundWithAuthData</span><span class="p">:</span><span class="n">authData</span> <span class="nf">completionBlock</span><span class="p">:</span><span class="o">^</span><span class="n">id</span> <span class="n">_Nullable</span><span class="p">(</span><span class="n">YourUserClass</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">loggedInUser</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//we can now update the user with the user data...
</span>        <span class="n">NSString</span> <span class="o">*</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">ln</span><span class="p">,</span> <span class="o">*</span><span class="n">g</span><span class="p">,</span> <span class="o">*</span><span class="n">pp</span><span class="p">,</span> <span class="o">*</span><span class="n">dob</span><span class="p">,</span> <span class="o">*</span><span class="n">em</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="n">data</span> <span class="k">in</span> <span class="n">userData</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="s">@"attribute"</span><span class="p">]</span> <span class="nf">isEqualToString</span><span class="p">:</span><span class="s">@"First Name"</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">@"value"</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="s">@"attribute"</span><span class="p">]</span> <span class="nf">isEqualToString</span><span class="p">:</span><span class="s">@"Last Name"</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">ln</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">@"value"</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="s">@"attribute"</span><span class="p">]</span> <span class="nf">isEqualToString</span><span class="p">:</span><span class="s">@"Emails"</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="s">@"value"</span><span class="p">]</span> <span class="nf">isKindOfClass</span><span class="p">:[</span><span class="n">NSArray</span> <span class="nf">class</span><span class="p">]])</span> <span class="p">{</span>
                    <span class="n">em</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">@"value"</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span> <span class="c1">//We pick the first email from the list since our system doesn't support multiple emails.
</span>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">em</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">@"value"</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="s">@"attribute"</span><span class="p">]</span> <span class="nf">isEqualToString</span><span class="p">:</span><span class="s">@"Gender"</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">@"value"</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="s">@"attribute"</span><span class="p">]</span> <span class="nf">isEqualToString</span><span class="p">:</span><span class="s">@"Profile Picture"</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">pp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">@"value"</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="s">@"attribute"</span><span class="p">]</span> <span class="nf">isEqualToString</span><span class="p">:</span><span class="s">@"Date of Birth"</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">dob</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">@"value"</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">NSString</span> <span class="o">*</span><span class="n">fullname</span> <span class="o">=</span> <span class="p">[[[</span><span class="s">@""</span> <span class="nf">stringByAppendingString</span><span class="p">:((</span><span class="n">fn</span><span class="p">)?</span><span class="n">fn</span><span class="p">:</span><span class="s">@""</span><span class="p">)]</span> <span class="nf">stringByAppendingString</span><span class="p">:((((</span><span class="n">fn</span><span class="p">)?</span><span class="n">fn</span><span class="p">:</span><span class="s">@""</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">ln</span><span class="p">)?</span><span class="s">@" "</span><span class="p">:</span><span class="s">@""</span><span class="p">)]</span> <span class="nf">stringByAppendingString</span><span class="p">:((</span><span class="n">ln</span><span class="p">)?</span><span class="n">ln</span><span class="p">:</span><span class="s">@""</span><span class="p">)];</span>
        <span class="n">loggedInUser</span><span class="p">[</span><span class="s">@"first_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn</span><span class="p">;</span>
        <span class="n">loggedInUser</span><span class="p">[</span><span class="s">@"last_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">ln</span><span class="p">;</span>
        <span class="n">loggedInUser</span><span class="p">[</span><span class="s">@"fullname"</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullname</span><span class="p">;</span>
        <span class="n">loggedInUser</span><span class="p">[</span><span class="s">@"email"</span><span class="p">]</span> <span class="o">=</span> <span class="n">em</span><span class="p">;</span>
        <span class="n">loggedInUser</span><span class="p">[</span><span class="s">@"gender"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="nf">lowercaseString</span><span class="p">];</span>
        <span class="n">loggedInUser</span><span class="p">[</span><span class="s">@"picture_url"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pp</span><span class="p">;</span>
        <span class="n">loggedInUser</span><span class="p">[</span><span class="s">@"dob"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dob</span><span class="p">;</span>
        <span class="n">loggedInUser</span><span class="p">[</span><span class="s">@"ia_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">ia_id</span><span class="p">;</span>
        <span class="n">loggedInUser</span><span class="p">[</span><span class="s">@"ia_username"</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">IALabel</span><span class="p">.</span><span class="n">text</span><span class="p">;</span>
        <span class="p">[</span><span class="n">newUser</span> <span class="nf">saveInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">succeeded</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">NotificationCenter</span> <span class="nf">post</span><span class="p">:</span><span class="n">NOTIFICATION_USER_LOGGED_IN</span><span class="p">];</span>
            <span class="p">[</span><span class="n">self</span> <span class="nf">gotToMainView</span><span class="p">];</span>
        <span class="p">}];</span>
        <span class="k">return</span>  <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>

<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="n">displayIAForm</span><span class="o">:</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">sender</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">UIView</span> <span class="nf">animateWithDuration</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span> <span class="nf">animations</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">IALabel</span><span class="p">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">IAButton</span><span class="p">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">completion</span><span class="o">:^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">IALabel</span> <span class="nf">becomeFirstResponder</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="n">hideIAForm</span><span class="o">:</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">sender</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">self</span><span class="p">.</span><span class="n">IALabel</span> <span class="nf">isFirstResponder</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">IALabel</span> <span class="nf">resignFirstResponder</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">UIView</span> <span class="nf">animateWithDuration</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span> <span class="nf">animations</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">IALabel</span><span class="p">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">IAButton</span><span class="p">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">completion</span><span class="o">:^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//
</span>    <span class="p">}];</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">textFieldShouldReturn</span><span class="o">:</span><span class="p">(</span><span class="n">UITextField</span> <span class="o">*</span><span class="p">)</span><span class="n">textField</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">loginWithIA</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">IAButton</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">You</span> <span class="n">will</span> <span class="n">probably</span> <span class="n">need</span> <span class="n">to</span> <span class="n">implement</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">onKeyboardFrameChange</span><span class="o">:</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="n">notification</span>
<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">onKeyboardShow</span><span class="o">:</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="n">notification</span>
<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">onKeyboardHide</span><span class="o">:</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="n">notification</span>

<span class="n">To</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">IALabel</span> <span class="n">is</span> <span class="n">visible</span> <span class="n">when</span> <span class="n">the</span> <span class="n">keyboard</span> <span class="n">is</span> <span class="n">displayed</span><span class="p">...</span>

<span class="n">Any</span> <span class="n">questions</span><span class="p">,</span> <span class="n">direct</span> <span class="n">message</span> <span class="err">@Chris</span> <span class="n">on</span> <span class="n">slack</span> <span class="n">https</span><span class="o">:</span><span class="c1">//ia-app.slack.com/messages
</span>
</code></pre><h2 id='for-collecting-payment-from-your-clients'>For collecting payment from your clients.</h2>
<aside class="notice">
You must replace <code>YOUR_PAYMENT_AMOUNT_WITH_THE_REGISTERED_CURRENCY_FOR_YOU_ON_IA_PLATFORM</code> with your payment that you want to collect from your user.
</aside>

<aside class="notice">
The Payment currency is the currency that you requested when you registered with the IA Platform.
</aside>

<blockquote>
<p>To integrate IA on your website collecting payment from your clients, add this code snippet to your website:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code>  <span class="c">&lt;!--</span> <span class="nx">IA</span> <span class="nx">Authentication</span> <span class="o">--&gt;</span>
  <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"text/javascript"</span><span class="o">&gt;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">client_id</span> <span class="o">=</span> <span class="s1">'IA_PARTNER_CLIENT_ID_KEY'</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">client_secret</span> <span class="o">=</span> <span class="s1">'IA_PARTNER_CLIENT_SECRET_KEY'</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">payment</span> <span class="o">=</span> <span class="s1">'YOUR_PAYMENT_AMOUNT_WITH_THE_REGISTERED_CURRENCY_FOR_YOU_ON_IA_PLATFORM'</span><span class="p">;</span>

      <span class="kd">function</span> <span class="nx">successIA</span><span class="p">(</span><span class="nx">usernameOrEmail</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle successLogin in IA</span>
        <span class="c1">// Example: window.location = 'IACompleteRegisteration.php?iaUser='+usernameOrEmail</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">deniedIA</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">timeoutIA</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>


      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'ia-framework-login'</span><span class="p">).</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">'https://dashboard.instantaccess.io/api/partner/authorize/view?client_id='</span><span class="o">+</span><span class="nx">client_id</span><span class="o">+</span><span class="s1">'&amp;client_secret='</span><span class="o">+</span><span class="nx">client_secret</span><span class="o">+</span><span class="s1">'&amp;payment='</span><span class="o">+</span><span class="nx">payment</span><span class="p">;</span>
      <span class="c1">//listen to ia back</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!==</span> <span class="s1">'https://dashboard.instantaccess.io'</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'alert'</span><span class="p">)</span>
          <span class="nx">alert</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'closeframe'</span><span class="p">)</span> <span class="p">{</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"ia-btn"</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">"block"</span><span class="p">;</span>
          <span class="nx">fade</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"ia-framework-login"</span><span class="p">));</span>
          <span class="c1">//document.getElementById("ia-framework-login").style.display = "none";</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'auth'</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">switch</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">'success'</span><span class="p">:</span>
              <span class="nx">successIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">usernameOrEmail</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">'denied'</span><span class="p">:</span>
              <span class="nx">deniedIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">'timeout'</span><span class="p">:</span>
              <span class="nx">timeoutIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">iaButtonClicked</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">unfade</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"ia-framework-login"</span><span class="p">));</span>
      <span class="c1">//document.getElementById("ia-framework-login").style.display = "block";</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"ia-btn"</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">fade</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// initial opacity</span>
      <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">op</span> <span class="o">&lt;=</span> <span class="mf">0.1</span><span class="p">){</span>
          <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
          <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">'none'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">op</span><span class="p">;</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="s1">'alpha(opacity='</span> <span class="o">+</span> <span class="nx">op</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">;</span>
        <span class="nx">op</span> <span class="o">-=</span> <span class="nx">op</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span>
      <span class="p">},</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">unfade</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>  <span class="c1">// initial opacity</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">'block'</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">op</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">){</span>
          <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">op</span><span class="p">;</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="s1">'alpha(opacity='</span> <span class="o">+</span> <span class="nx">op</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">;</span>
        <span class="nx">op</span> <span class="o">+=</span> <span class="nx">op</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span>
      <span class="p">},</span> <span class="mi">5</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="s2">"display: inline-block; position: relative;"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"button"</span> <span class="nx">onclick</span><span class="o">=</span><span class="s2">"iaButtonClicked()"</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"ia-btn"</span> <span class="nx">style</span><span class="o">=</span><span class="s2">"background-color: #4A4A4A; border-width: 0; padding: 0; width: 56px; height: 56px; border-radius:10px;"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"https://dashboard.instantaccess.io/upload/image/whitelogo.svg"</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">iframe</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"ia-framework-login"</span> <span class="nx">src</span><span class="o">=</span><span class="s2">""</span> <span class="nx">width</span><span class="o">=</span><span class="s2">"170"</span> <span class="nx">height</span><span class="o">=</span><span class="s2">"215"</span> <span class="nx">frameBorder</span><span class="o">=</span><span class="s2">"0"</span> <span class="nx">style</span><span class="o">=</span><span class="s2">"display:none; border-radius:10px; z-index: 1000; position: absolute; left: 0px; bottom: 0px;"</span><span class="o">&gt;&lt;</span><span class="sr">/iframe</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
    <span class="err">#</span><span class="nx">ia</span><span class="o">-</span><span class="nx">btn</span><span class="p">:</span><span class="nx">focus</span> <span class="p">{</span>
      <span class="nx">outline</span><span class="o">-</span><span class="nx">width</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="err">#</span><span class="nx">ia</span><span class="o">-</span><span class="nx">btn</span><span class="p">:</span><span class="nx">hover</span> <span class="p">{</span>
      <span class="nl">opacity</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">;</span>
      <span class="nl">cursor</span><span class="p">:</span> <span class="nx">pointer</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span>  <span class="c">&lt;!--</span> <span class="nx">End</span> <span class="nx">of</span> <span class="nx">login</span> <span class="kd">with</span> <span class="nx">IA</span> <span class="o">--&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript--react"><code><span class="o">&gt;</span> <span class="nx">Step</span> <span class="mi">1</span><span class="p">:</span> <span class="nx">IAButton</span> <span class="nx">React</span> <span class="nx">component</span> <span class="nx">source</span> <span class="nx">code</span> <span class="o">-</span> <span class="nx">save</span> <span class="k">this</span> <span class="nx">file</span> <span class="nx">as</span> <span class="nx">IAButton</span><span class="p">.</span><span class="nx">js</span> <span class="k">in</span> <span class="nx">your</span> <span class="nx">project</span>

<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">"react"</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">PropTypes</span> <span class="nx">from</span> <span class="s1">'prop-types'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">IAButton</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

    <span class="nx">constructor</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">iaWhiteLogoSource</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">iaServer</span><span class="o">+</span><span class="s1">'/upload/image/whitelogo.svg'</span><span class="p">,</span>
            <span class="na">iaFrameSource</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">iaServer</span><span class="o">+</span><span class="s1">'/api/partner/authorize/view?client_id='</span><span class="o">+</span><span class="nx">props</span><span class="p">.</span><span class="nx">clientId</span><span class="o">+</span><span class="s1">'&amp;client_secret='</span><span class="o">+</span><span class="nx">props</span><span class="p">.</span><span class="nx">clientSecret</span><span class="o">+</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">payment</span><span class="p">?(</span><span class="s1">'&amp;payment='</span><span class="o">+</span><span class="nx">props</span><span class="p">.</span><span class="nx">payment</span><span class="p">):</span><span class="s1">''</span><span class="p">),</span>
            <span class="na">iaButtonHovered</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">iaButtonFocused</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">iaButtonHidden</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">iaFrameDisplayed</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">iaFrameOpacity</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="na">iaFrameFilter</span><span class="p">:</span> <span class="s1">'alpha(opacity=0)'</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">componentDidMount</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleIAMessage</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">componentWillUnmount</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleIAMessage</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">handleIAMessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">eventOrigin</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">origin</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">iaServer</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">"http"</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">eventOrigin</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">"http:"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">eventOrigin</span> <span class="o">=</span> <span class="nx">eventOrigin</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">eventOrigin</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">"https:"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">eventOrigin</span> <span class="o">=</span> <span class="nx">eventOrigin</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">eventOrigin</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">iaServer</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'alert'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'closeframe'</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="na">iaBtnHidden</span><span class="p">:</span> <span class="kc">false</span>
            <span class="p">});</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">fadeIAFrame</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">'auth'</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="s1">'success'</span><span class="p">:</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">successIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">usernameOrEmail</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="s1">'denied'</span><span class="p">:</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">deniedIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="s1">'timeout'</span><span class="p">:</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">timeoutIA</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">successIA</span> <span class="p">(</span><span class="nx">usernameOrEmail</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle successLogin in IA</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">successIA</span><span class="p">(</span><span class="nx">usernameOrEmail</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">deniedIA</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">notifyUser</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">deniedIA</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">timeoutIA</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">notifyUser</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">timeoutIA</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">iaButtonClicked</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">unfadeIAFrame</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="na">iaBtnHidden</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">fadeIAFrame</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// initial opacity</span>
        <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">op</span> <span class="o">&lt;=</span> <span class="mf">0.1</span><span class="p">){</span>
                <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaFrameDisplayed</span><span class="p">:</span> <span class="kc">false</span><span class="p">});</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="na">iaFrameOpacity</span><span class="p">:</span> <span class="nx">op</span><span class="p">,</span>
                <span class="na">iaFrameFilter</span><span class="p">:</span> <span class="s1">'alpha(opacity='</span> <span class="o">+</span> <span class="nx">op</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s1">')'</span>
            <span class="p">});</span>
            <span class="nx">op</span> <span class="o">-=</span> <span class="nx">op</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span>
        <span class="p">},</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">unfadeIAFrame</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>  <span class="c1">// initial opacity</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaFrameDisplayed</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
        <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">op</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">){</span>
                <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="na">iaFrameOpacity</span><span class="p">:</span> <span class="nx">op</span><span class="p">,</span>
                <span class="na">iaFrameFilter</span><span class="p">:</span> <span class="s1">'alpha(opacity='</span> <span class="o">+</span> <span class="nx">op</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s1">')'</span>
            <span class="p">});</span>
            <span class="nx">op</span> <span class="o">+=</span> <span class="nx">op</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span>
        <span class="p">},</span> <span class="mi">5</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">mainDiv</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"button"</span>
                        <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">iaButtonClicked</span><span class="p">()}</span>
                        <span class="nx">onMouseEnter</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaButtonHovered</span><span class="p">:</span> <span class="kc">true</span><span class="p">})}</span>
                        <span class="nx">onMouseLeave</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaButtonHovered</span><span class="p">:</span> <span class="kc">false</span><span class="p">})}</span>
                        <span class="nx">onFocus</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaButtonFocused</span><span class="p">:</span> <span class="kc">true</span><span class="p">})}</span>
                        <span class="nx">onBlur</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">iaButtonFocused</span><span class="p">:</span> <span class="kc">false</span><span class="p">})}</span>
                        <span class="nx">style</span><span class="o">=</span><span class="p">{{...</span><span class="nx">styles</span><span class="p">.</span><span class="nx">iaBtn</span><span class="p">,</span> <span class="p">...{</span><span class="na">opacity</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaButtonHovered</span> <span class="p">?</span> <span class="mf">0.9</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">outlineWidth</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaButtonFocused</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="s1">'inherit'</span><span class="p">,</span> <span class="na">display</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaBtnHidden</span> <span class="p">?</span> <span class="s1">'hidden'</span> <span class="p">:</span> <span class="s1">'block'</span><span class="p">}}}</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaWhiteLogoSource</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">iframe</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaFrameSource</span><span class="p">}</span> <span class="nx">width</span><span class="o">=</span><span class="s2">"170"</span> <span class="nx">height</span><span class="o">=</span><span class="s2">"215"</span> <span class="nx">frameBorder</span><span class="o">=</span><span class="s2">"0"</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{...</span><span class="nx">styles</span><span class="p">.</span><span class="nx">iaFrame</span><span class="p">,</span> <span class="p">...{</span><span class="na">opacity</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaFrameOpacity</span><span class="p">,</span> <span class="na">filter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaFrameFilter</span><span class="p">,</span> <span class="na">display</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">iaFrameDisplayed</span> <span class="p">?</span> <span class="s1">'block'</span> <span class="p">:</span> <span class="s1">'none'</span><span class="p">}}}</span><span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">IAButton</span><span class="p">.</span><span class="nx">propTypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">iaServer</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">string</span><span class="p">,</span>
    <span class="na">clientId</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">string</span><span class="p">.</span><span class="nx">isRequired</span><span class="p">,</span>
    <span class="na">clientSecret</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">string</span><span class="p">.</span><span class="nx">isRequired</span><span class="p">,</span>
    <span class="na">payment</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">string</span><span class="p">,</span>
    <span class="na">notifyUser</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">bool</span><span class="p">,</span>
    <span class="na">successIA</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">.</span><span class="nx">isRequired</span><span class="p">,</span>
    <span class="na">deniedIA</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">.</span><span class="nx">isRequired</span><span class="p">,</span>
    <span class="na">timeoutIA</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">.</span><span class="nx">isRequired</span>
<span class="p">};</span>

<span class="nx">IAButton</span><span class="p">.</span><span class="nx">defaultProps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">notifyUser</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">iaServer</span><span class="p">:</span> <span class="s1">'//dashboard.instantaccess.io'</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">styles</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">mainDiv</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">display</span><span class="p">:</span> <span class="s1">'inline-block'</span><span class="p">,</span>
        <span class="na">position</span><span class="p">:</span> <span class="s1">'relative'</span>
    <span class="p">},</span>
    <span class="na">iaBtn</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">backgroundColor</span><span class="p">:</span> <span class="s1">'#4A4A4A'</span><span class="p">,</span>
        <span class="na">borderWidth</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">width</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span>
        <span class="na">height</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span>
        <span class="na">borderRadius</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
        <span class="na">cursor</span><span class="p">:</span> <span class="s1">'pointer'</span>
    <span class="p">},</span>
    <span class="na">iaFrame</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">display</span><span class="p">:</span><span class="s1">'none'</span><span class="p">,</span>
        <span class="na">borderRadius</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
        <span class="na">zIndex</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="na">position</span><span class="p">:</span> <span class="s1">'absolute'</span><span class="p">,</span>
        <span class="na">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">bottom</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="o">&gt;</span> <span class="nx">End</span> <span class="nx">of</span> <span class="nx">Step</span> <span class="mi">1</span>


<span class="o">&gt;</span> <span class="nx">Step</span> <span class="mi">2</span><span class="p">:</span> <span class="nx">Add</span> <span class="nx">IAButton</span> <span class="nx">component</span> <span class="nx">where</span> <span class="nx">you</span> <span class="nx">need</span>

  <span class="o">&lt;</span><span class="nx">IAButton</span> <span class="nx">clientId</span><span class="o">=</span><span class="s2">"IA_PARTNER_CLIENT_ID_KEY"</span>
            <span class="nx">clientSecret</span><span class="o">=</span><span class="s2">"IA_PARTNER_CLIENT_SECRET_KEY"</span>
            <span class="nx">payment</span><span class="o">=</span><span class="s2">"YOUR_PAYMENT_AMOUNT_WITH_THE_REGISTERED_CURRENCY_FOR_YOU_ON_IA_PLATFORM"</span><span class="p">;</span>
            <span class="nx">notifyUser</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span>
            <span class="nx">successIA</span><span class="o">=</span><span class="p">{(</span><span class="nx">usernameOrEmail</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">IA_SUCCESS_HANDLER</span><span class="p">}</span>
            <span class="nx">deniedIA</span><span class="o">=</span><span class="p">{(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">OPTIONAL_IA_DENIED_HANDLER</span><span class="p">}</span>
            <span class="nx">timeoutIA</span><span class="o">=</span><span class="p">{(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">OPTIONAL_IA_TIMEOUT_HANDLER</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>
<span class="o">&gt;</span> <span class="na">Note</span><span class="p">:</span> <span class="nx">In</span> <span class="nx">IA_SUCCESS_HANDLER</span> <span class="nx">you</span> <span class="nx">should</span> <span class="nx">handle</span> <span class="nx">user</span> <span class="nx">authentication</span> <span class="nx">and</span> <span class="nx">make</span> <span class="nx">actions</span><span class="p">,</span> <span class="nx">applicable</span> <span class="nx">to</span> <span class="nx">your</span> <span class="nx">website</span>

<span class="o">&gt;</span> <span class="na">Note</span><span class="p">:</span> <span class="nx">If</span> <span class="nx">you</span> <span class="nx">don</span><span class="err">'</span><span class="nx">t</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">handle</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">denied</span><span class="p">,</span> <span class="nx">or</span> <span class="nx">timeout</span><span class="p">,</span> <span class="nx">replace</span> <span class="o">*</span><span class="nx">_HANDLER</span> <span class="kd">with</span> <span class="p">{}</span>

<span class="o">&gt;</span> <span class="nx">End</span> <span class="nx">of</span> <span class="nx">Step</span> <span class="mi">2</span>
</code></pre><h1 id='handling-ia-authentication'>Handling IA Authentication</h1>
<p>IA System will call one of this three methods when finish IA Authentication according to the status (success, denied or fail, timeout)</p>
<h2 id='success'>Success</h2><pre class="highlight javascript tab-javascript"><code>    <span class="kd">function</span> <span class="nx">successIA</span><span class="p">(</span><span class="nx">usernameOrEmail</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Handle successLogin in IA</span>
      <span class="c1">// Example: window.location = 'IACompleteRegisteration.php?iaUser='+usernameOrEmail</span>
    <span class="p">}</span>
</code></pre><pre class="highlight javascript tab-javascript--react"><code><span class="o">&gt;</span> <span class="nx">See</span> <span class="nx">Step</span> <span class="mi">2</span> <span class="nx">code</span> <span class="nx">snippet</span> <span class="nx">of</span> <span class="nx">IA</span> <span class="nx">Partner</span> <span class="nx">Integration</span>

    <span class="nx">successIA</span><span class="o">=</span><span class="p">{(</span><span class="nx">usernameOrEmail</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">IA_SUCCESS_HANDLER</span><span class="p">}</span>

<span class="o">&gt;</span> <span class="nx">replace</span> <span class="nx">IA_SUCCESS_HANDLER</span> <span class="kd">with</span> <span class="nx">your</span> <span class="nx">handler</span> <span class="nx">or</span> <span class="nx">use</span> <span class="p">{}</span>
</code></pre>
<p>This method will be called when user finished IA Authentication successfully and approved the request on their IA app.</p>

<p>Simply implement this method and continue your user flow, IA will provide all approved user info to your callback endpoint with the username and user email before calling this method. You can implement the callback to save these data for later use. Please refer to &#39;Callback Implementation Section&#39;.</p>

<p>You can fetch user data using ajax or reditect to another page in this method and continue your user process. All authorized user info must be saved now on your system via your callback url.</p>
<h3 id='query-parameters'>Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>usernameOrEmail</td>
<td>This is the username or email that the user used it to authenticate your service via IA System.</td>
</tr>
</tbody></table>
<h2 id='denied-or-failed'>Denied or Failed</h2><pre class="highlight javascript tab-javascript"><code>      <span class="kd">function</span> <span class="nx">deniedIA</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>
</code></pre><pre class="highlight javascript tab-javascript--react"><code><span class="o">&gt;</span> <span class="nx">See</span> <span class="nx">Step</span> <span class="mi">2</span> <span class="nx">code</span> <span class="nx">snippet</span> <span class="nx">of</span> <span class="nx">IA</span> <span class="nx">Partner</span> <span class="nx">Integration</span>

     <span class="nx">deniedIA</span><span class="o">=</span><span class="p">{(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">OPTIONAL_IA_DENIED_HANDLER</span><span class="p">}</span>

<span class="o">&gt;</span> <span class="nx">replace</span> <span class="nx">OPTIONAL_IA_DENIED_HANDLER</span> <span class="kd">with</span> <span class="nx">your</span> <span class="nx">handler</span> <span class="nx">or</span> <span class="nx">use</span> <span class="p">{}</span>
</code></pre>
<p>This method will be called if your website user denied the IA Authentication request on the IA App or the request fail for any other reason.</p>

<p>By default, this method alerts the user with a failing message, however you can change this to suit your need.</p>
<h3 id='query-parameters-2'>Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>message</td>
<td>It contains the reason of failure if the user denied the process, ...etc.</td>
</tr>
</tbody></table>
<h2 id='timeout'>Timeout</h2><pre class="highlight javascript tab-javascript"><code>      <span class="kd">function</span> <span class="nx">timeoutIA</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>
</code></pre><pre class="highlight javascript tab-javascript--react"><code><span class="o">&gt;</span> <span class="nx">See</span> <span class="nx">Step</span> <span class="mi">2</span> <span class="nx">code</span> <span class="nx">snippet</span> <span class="nx">of</span> <span class="nx">IA</span> <span class="nx">Partner</span> <span class="nx">Integration</span>

      <span class="nx">timeoutIA</span><span class="o">=</span><span class="p">{(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">OPTIONAL_IA_TIMEOUT_HANDLER</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>
<span class="o">&gt;</span> <span class="nx">replace</span> <span class="nx">OPTIONAL_IA_TIMEOUT_HANDLER</span> <span class="kd">with</span> <span class="nx">your</span> <span class="nx">handler</span> <span class="nx">or</span> <span class="nx">use</span> <span class="p">{}</span>
</code></pre>
<p>This method will be called if user failed to respond to IA request over IA App.</p>

<p>By default, this method alerts the user with a timeout message.</p>
<h3 id='query-parameters-3'>Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>message</td>
<td>It contains timeout message.</td>
</tr>
</tbody></table>
<h1 id='callback-implementation'>Callback Implementation</h1>
<p>The callback is requested from IA platform in two conditions:</p>

<p>1- When user approved the request over IA App, the Callback URL will be called with two parameters.
2- When user update any information in partner website.</p>
<h2 id='callback-when-user-approve-request-over-ia-app'>Callback when user approve request over IA App</h2><pre class="highlight javascript tab-javascript"><code>
<span class="c1">// cloud functions dependencies.</span>
<span class="kr">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'firebase-functions'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="c1">// callback endpoint config.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">authorizationCode</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">code</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
  <span class="kr">const</span> <span class="p">[</span> <span class="nx">userid</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">email</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'@@'</span><span class="p">);</span>

  <span class="c1">// do some stuff with your received data.</span>
  <span class="c1">// ...</span>

  <span class="c1">// send an OK response.</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">yourCloudFunction</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nx">onRequest</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</code></pre><pre class="highlight php tab-php"><code>$authorizationCode = $_GET['code'];
$state = $_GET['state'];
$stateArr = explode("@@", $state);
$userid = $stateArr[0];
$username = $stateArr[1];
$email = $stateArr[2];
</code></pre><h3 id='http-request'>HTTP Request</h3>
<p><code>GET http://yourwebsite.com/yourCallBackurl?code={AUTHORIZATION_CODE}&amp;state={userid}@@{username}@@{email}</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>code</td>
<td>the Authorization Code that used to fetch the user’s token from IA</td>
</tr>
<tr>
<td>state</td>
<td>this string contains the userid, username and email concatenated with &#39;@@&#39;, you can split them and use them.</td>
</tr>
</tbody></table>
<h2 id='callback-when-user-update-any-information'>Callback when user update any information</h2><pre class="highlight php tab-php"><code>$userId = $_POST['user_id'];
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="c1">// ...</span>

<span class="c1">// callback endpoint config.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">userId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user_id</span><span class="p">;</span>

  <span class="c1">// do some stuff with your received data.</span>
  <span class="c1">// ...</span>

  <span class="c1">// send an OK response.</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// ...</span>
</code></pre><h3 id='http-request-2'>HTTP Request</h3>
<p><code>POST http://yourwebsite.com/yourCallBackurl</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>user_id</td>
<td>the user id for the user who updated any associated info.</td>
</tr>
</tbody></table>
<h2 id='fetching-user-access-token-from-ia-api'>Fetching User Access Token from IA API</h2><pre class="highlight php tab-php"><code>//setup the request, you can also use CURLOPT_URL
$curl = curl_init('https://dashboard.instantaccess.io/api/oauth/token');

// SET API request type as post
curl_setopt($curl, CURLOPT_POST, 1);

// Returns the data/output as a string instead of raw data
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);
curl_setopt($curl, CURLOPT_POSTFIELDS, http_build_query(array('client_id'=&gt;'IA_PARTNER_CLIENT_ID_KEY',
                                                              'client_secret'=&gt;'IA_PARTNER_CLIENT_SECRET_KEY',
                                                              'code'=&gt;'your Authorization Code that provided in the previous step',
                                                              'redirect_uri' =&gt; 'your callback url',
                                                              'grant_type'=&gt;'authorization_code')));

$result = curl_exec($curl);

curl_close($curl);

if($result !== FALSE) {
  $data = json_decode($result,true);
  $user_access_token = $data["access_token"];
  $user__refresh_token = $data["refresh_token"];
  $user_access_token_expiry = $data["expires_in"];
}
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="c1">// ...</span>

<span class="c1">// you may need a npm module to make HTTP requests...</span>
<span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'axios'</span><span class="p">);</span>

<span class="c1">// ...and one npm module to parse the data you're going to POST.</span>
<span class="kr">const</span> <span class="nx">qs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'querystring'</span><span class="p">);</span>

<span class="c1">// callback endpoint config.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>

  <span class="c1">// data you're going to POST.</span>
  <span class="kr">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">code</span><span class="p">:</span> <span class="s1">'the authorization code you received in previous step'</span><span class="p">,</span>
    <span class="na">client_id</span><span class="p">:</span> <span class="s1">'&lt;YOUR-IA_PARTNER_CLIENT_ID_KEY&gt;'</span><span class="p">,</span>
    <span class="na">client_secret</span><span class="p">:</span> <span class="s1">'&lt;YOUR-IA_PARTNER_CLIENT_SECRET_KEY&gt;'</span><span class="p">,</span>
    <span class="na">redirect_uri</span><span class="p">:</span> <span class="s1">'your callback url (your cloud function url)'</span><span class="p">,</span>
    <span class="na">grant_type</span><span class="p">:</span> <span class="s1">'authorization_code'</span>
  <span class="p">};</span>

  <span class="c1">// HTTP request configuration.</span>
  <span class="kr">const</span> <span class="nx">fetchAccessTokenConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">url</span><span class="p">:</span> <span class="s1">'https://dashboard.instantaccess.io/api/oauth/token'</span><span class="p">,</span>
    <span class="na">method</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
  <span class="p">};</span>

  <span class="c1">// Instant Access API call.</span>
  <span class="nx">http</span><span class="p">(</span><span class="nx">fetchAccessTokenConfig</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>

      <span class="c1">// do some stuff with your received data.</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

    <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">));</span>

  <span class="c1">// send an OK response.</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// ...</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"THE_USER_ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"THE_USER_REFRESH_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="s2">"THE_NUMBER_SECONDS_OF_UNTIL_THE_ACCESS_TOKEN_EXPIRES"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Please use the authorization code provided previously to fetch user access token and refresh token then save it in your users record. (database, files, ...etc)</p>

<aside class="success">
This token is required everytime your system requests user info from IA.
</aside>
<h3 id='http-request-3'>HTTP Request</h3>
<p><code>POST https://dashboard.instantaccess.io/api/oauth/token</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>client_id</td>
<td>your IA_PARTNER_CLIENT_ID_KEY</td>
</tr>
<tr>
<td>client_secret</td>
<td>your IA_PARTNER_CLIENT_SECRET_KEY</td>
</tr>
<tr>
<td>code</td>
<td>your Authorization Code that provided in the previous step</td>
</tr>
<tr>
<td>redirect_uri</td>
<td>your callback url</td>
</tr>
<tr>
<td>grant_type</td>
<td>always with string value &#39;authorization_code&#39;</td>
</tr>
</tbody></table>
<h2 id='refreshing-user-access-token-from-ia-api'>Refreshing User Access Token from IA API</h2><pre class="highlight php tab-php"><code>//setup the request, you can also use CURLOPT_URL
$curl = curl_init('https://dashboard.instantaccess.io/api/oauth/token');

// SET API request type as post
curl_setopt($curl, CURLOPT_POST, 1);

// Returns the data/output as a string instead of raw data
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);
curl_setopt($curl, CURLOPT_POSTFIELDS, http_build_query(array('client_id'=&gt;'IA_PARTNER_CLIENT_ID_KEY',
                                                              'client_secret'=&gt;'IA_PARTNER_CLIENT_SECRET_KEY',
                                                              'refresh_token'=&gt;'USER_REFRESH_TOKEN',
                                                              'grant_type'=&gt;'refresh_token',
                                                              'scope' =&gt; '')));

$result = curl_exec($curl);

curl_close($curl);

if($result !== FALSE) {
  $data = json_decode($result,true);
  $user_access_token = $data["access_token"];
  $user__refresh_token = $data["refresh_token"];
  $user_access_token_expiry = $data["expires_in"];
}
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="c1">// same npm modules</span>
<span class="c1">// ...</span>

<span class="c1">// callback endpoint config.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>

  <span class="c1">// the only thing that changes is the data you're going to POST.</span>
  <span class="kr">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">refresh_token</span><span class="p">:</span> <span class="s1">'the authorization code you received in previous step'</span><span class="p">,</span>
    <span class="na">client_id</span><span class="p">:</span> <span class="s1">'&lt;YOUR-IA_PARTNER_CLIENT_ID_KEY&gt;'</span><span class="p">,</span>
    <span class="na">client_secret</span><span class="p">:</span> <span class="s1">'&lt;YOUR-IA_PARTNER_CLIENT_SECRET_KEY&gt;'</span><span class="p">,</span>
    <span class="na">grant_type</span><span class="p">:</span> <span class="s1">'refresh_token'</span><span class="p">,</span>
    <span class="na">scope</span><span class="p">:</span> <span class="s1">''</span>
  <span class="p">};</span>

  <span class="c1">// same config you used to fetch access token.</span>
  <span class="c1">// ...</span>

  <span class="c1">// send an OK response.</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// ...</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"THE_USER_ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"THE_USER_REFRESH_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="s2">"THE_NUMBER_OF_SECONDS_UNTIL_THE_ACCESS_TOKEN_EXPIRES"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Please use the refresh_token provided previously to fetch new user access token and refresh token then save it in your users record. (database, files, ...etc)</p>

<aside class="success">
This token is required everytime your system requests user info from IA.
</aside>
<h3 id='http-request-4'>HTTP Request</h3>
<p><code>POST https://dashboard.instantaccess.io/api/oauth/token</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>client_id</td>
<td>your IA_PARTNER_CLIENT_ID_KEY</td>
</tr>
<tr>
<td>client_secret</td>
<td>your IA_PARTNER_CLIENT_SECRET_KEY</td>
</tr>
<tr>
<td>refresh_token</td>
<td>your Authorization Code that provided in the previous step</td>
</tr>
<tr>
<td>grant_type</td>
<td>always with string value &#39;refresh_token&#39;</td>
</tr>
<tr>
<td>scope</td>
<td>send it with empty string &#39;&#39;</td>
</tr>
</tbody></table>
<h2 id='fetching-user-information-from-ia-api'>Fetching User Information from IA API</h2><pre class="highlight php tab-php"><code>if($result !== FALSE) {
  $data = json_decode($result,true);
  $user_token = $data["access_token"];
}

//setup the request, you can also use CURLOPT_URL
$curl = curl_init('https://dashboard.instantaccess.io/api/public/user');

// Returns the data/output as a string instead of raw data
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);
//Set your auth headers
curl_setopt($curl, CURLOPT_HTTPHEADER, array(
    'Content-Type: application/json',
    'Authorization: Bearer ' . $user_token
    ));

$result = curl_exec($curl);

curl_close($curl);

if($result !== FALSE) {

  $json = json_decode($result);
  $data = $json-&gt;data

  // Save it in your DB is the best choice :)
  file_put_contents('ANY FILE PATH', json_encode($data));
}
</code></pre><pre class="highlight javascript tab-javascript"><code>
<span class="c1">// ...</span>

<span class="c1">// callback endpoint config.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// same config you used to fetch access token.</span>
  <span class="c1">// ...</span>

  <span class="c1">// and this new one.</span>
  <span class="kr">const</span> <span class="nx">fetchUserInfoConfig</span> <span class="o">=</span> <span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">url</span><span class="p">:</span> <span class="s1">'https://dashboard.instantaccess.io/api/public/user'</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json'</span><span class="p">,</span>
        <span class="s1">'Authorization'</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">access_token</span><span class="p">}</span><span class="s2">`</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="c1">// since we are using Promises,</span>
  <span class="c1">// you can chain Instant Access API calls.</span>
  <span class="nx">http</span><span class="p">(</span><span class="nx">fetchAccessTokenConfig</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="nx">fetchUserInfoConfig</span><span class="p">(</span><span class="nx">response</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">data</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

        <span class="c1">// do some stuff with your received data</span>
        <span class="c1">// (e.g. save it in your database).</span>
      <span class="p">}</span>
    <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">));</span>

  <span class="c1">// send an OK response.</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// ...</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"User data items retrieved successfully"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="s2">"attribute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"First Name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hey"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="s2">"attribute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Last Name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Buddy"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="s2">"attribute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Emails"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test@test.com"</span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Please use the user token to fetch user info from IA system. You can process these info as you usually do (e.g. save in database).</p>

<aside class="success">
You can fetch user info with the user token via this api call at anytime.
</aside>
<h3 id='http-request-5'>HTTP Request</h3>
<p><code>GET https://dashboard.instantaccess.io/api/public/user</code></p>

<p>NO Parameters here just set the Headers as following</p>

<table><thead>
<tr>
<th>Header</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Content-Type</td>
<td>&#39;application/json&#39;</td>
</tr>
<tr>
<td>Authorization</td>
<td>&#39;Bearer {access_token that provided from last step}&#39;</td>
</tr>
</tbody></table>

<p>The data will retrieved in json string as following</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">JavaScript</a>
                <a href="#" data-language-name="javascript--react">React</a>
                <a href="#" data-language-name="objective_c">Objective-C</a>
                <a href="#" data-language-name="php">PHP</a>
                <a href="#" data-language-name="javascript">Google Cloud Functions</a>
          </div>
      </div>
    </div>
  </body>
</html>
